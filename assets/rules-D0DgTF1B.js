import{r,F as l,j as t,S,a as f,B as x,M as z,s as d}from"./index-C6T66UYw.js";import{d as D,e as C,f as B,g as h,N as J,h as k}from"./const-BskLJner.js";import{C as Y}from"./index-MJq_1bjb.js";import{S as m}from"./index-gul_2otK.js";import{R as H}from"./PlusOutlined-DadAM9jt.js";import{R as Q}from"./ExportOutlined-J_0Br3tR.js";import{F as W}from"./Table-rx-uFvO4.js";import{T as q}from"./index-QvxEnahu.js";import{S as w}from"./index-D3Omcvxu.js";import{T as R}from"./index-BWL1JphO.js";import{R as G}from"./EditOutlined-9U3olPbu.js";import{P as X}from"./index-C-4xovFz.js";import{R as Z}from"./DeleteOutlined-CETmvlP7.js";import"./Pagination-B3rYXXPg.js";import"./EditOutlined-DdmGLkPL.js";import"./DeleteOutlined-DFutYCzo.js";const{Search:ee}=f,{Option:j}=m,fe=()=>{const[n,c]=r.useState([]),[E]=r.useState(!1),[y,T]=r.useState(""),[v,b]=r.useState(""),[I,N]=r.useState(""),[A,u]=r.useState(!1),[s,g]=r.useState(null),[p]=l.useForm();r.useEffect(()=>{c(D)},[]);const _=()=>{g(null),p.resetFields(),u(!0)},O=e=>{g(e),p.setFieldsValue({...e,status:e.status==="active"}),u(!0)},F=e=>{c(n.filter(a=>a.id!==e)),d.success("删除成功")},M=e=>{c(n.map(a=>a.id===e?{...a,status:a.status==="active"?"inactive":"active"}:a)),d.success("状态更新成功")},L=async()=>{try{const e=await p.validateFields(),a={id:(s==null?void 0:s.id)||Date.now().toString(),name:e.name,type:e.type,thresholdValue:e.thresholdValue,threshold:`${P(e.type)} > ${e.thresholdValue}${K(e.type)}`,status:e.status?"active":"inactive",appName:e.appName,appKey:e.appKey,notificationMethods:e.notificationMethods||[],createTime:(s==null?void 0:s.createTime)||new Date().toLocaleString(),triggerCount:(s==null?void 0:s.triggerCount)||0};s?(c(n.map(o=>o.id===s.id?a:o)),d.success("更新成功")):(c([...n,a]),d.success("添加成功")),u(!1)}catch(e){console.error("表单验证失败:",e)}},P=e=>{switch(e){case"error":return"错误率";case"performance":return"页面加载时间";case"network":return"API响应时间";default:return"阈值"}},K=e=>{switch(e){case"error":return"%";case"performance":case"network":return"s";default:return""}},U=()=>{const e=JSON.stringify(n,null,2),a="data:application/json;charset=utf-8,"+encodeURIComponent(e),o="alert-rules.json",i=document.createElement("a");i.setAttribute("href",a),i.setAttribute("download",o),i.click(),d.success("导出成功")},V=[{title:"规则名称",dataIndex:"name",key:"name"},{title:"类型",dataIndex:"type",key:"type",render:e=>t.jsx(R,{color:k[e].color,children:k[e].text})},{title:"阈值条件",dataIndex:"threshold",key:"threshold"},{title:"关联应用",key:"app",render:e=>t.jsxs("div",{children:[t.jsx("div",{style:{fontWeight:500},children:e.appName}),t.jsx("div",{style:{fontSize:"12px",color:"#666"},children:e.appKey})]})},{title:"状态",dataIndex:"status",key:"status",render:(e,a)=>t.jsx(w,{checked:e==="active",onChange:()=>M(a.id),checkedChildren:"启用",unCheckedChildren:"禁用"})},{title:"触发次数",dataIndex:"triggerCount",key:"triggerCount",render:e=>t.jsx(R,{color:e>0?"orange":"default",children:e})},{title:"创建时间",dataIndex:"createTime",key:"createTime",width:180},{title:"操作",key:"action",width:200,render:(e,a)=>t.jsxs(S,{size:"small",children:[t.jsx(x,{size:"small",icon:t.jsx(G,{}),onClick:()=>O(a),children:"编辑"}),t.jsx(X,{title:"确定删除这个告警规则吗？",onConfirm:()=>F(a.id),okText:"确定",cancelText:"取消",children:t.jsx(x,{size:"small",danger:!0,icon:t.jsx(Z,{}),children:"删除"})})]})}],$=n.filter(e=>{const a=e.name.includes(y)||e.appName.includes(y)||e.appKey.includes(y),o=!v||e.type===v,i=!I||e.status===I;return a&&o&&i});return t.jsxs(Y,{children:[t.jsxs("div",{style:{marginBottom:16},children:[t.jsxs(S,{style:{marginBottom:16},children:[t.jsx(ee,{placeholder:"搜索规则名称、应用名称",allowClear:!0,style:{width:300},onSearch:T,onChange:e=>T(e.target.value)}),t.jsx(m,{placeholder:"选择类型",allowClear:!0,style:{width:120},onChange:b,children:C.map(e=>t.jsx(j,{value:e.value,children:e.label},e.value))}),t.jsx(m,{placeholder:"选择状态",allowClear:!0,style:{width:120},onChange:N,children:B.map(e=>t.jsx(j,{value:e.value,children:e.label},e.value))})]}),t.jsx("div",{children:t.jsxs(S,{children:[t.jsx(x,{type:"primary",icon:t.jsx(H,{}),onClick:_,children:"新建告警规则"}),t.jsx(x,{icon:t.jsx(Q,{}),onClick:U,children:"导出规则"})]})})]}),t.jsx(W,{columns:V,dataSource:$,rowKey:"id",loading:E,pagination:{showSizeChanger:!0,showQuickJumper:!0,showTotal:e=>`共 ${e} 条记录`}}),t.jsx(z,{title:s?"编辑告警规则":"新建告警规则",open:A,onOk:L,onCancel:()=>u(!1),width:600,children:t.jsxs(l,{form:p,layout:"vertical",children:[t.jsx(l.Item,{name:"name",label:"规则名称",rules:h.name,children:t.jsx(f,{placeholder:"输入告警规则名称"})}),t.jsx(l.Item,{name:"type",label:"监控类型",rules:h.type,children:t.jsx(m,{placeholder:"选择监控类型",children:C.map(e=>t.jsx(j,{value:e.value,children:e.label},e.value))})}),t.jsx(l.Item,{name:"thresholdValue",label:"阈值",rules:h.thresholdValue,children:t.jsx(q,{style:{width:"100%"},placeholder:"输入阈值数值",min:0,step:.1})}),t.jsx(l.Item,{name:"appName",label:"关联应用",rules:h.appName,children:t.jsx(f,{placeholder:"输入应用名称"})}),t.jsx(l.Item,{name:"appKey",label:"AppKey",rules:h.appKey,children:t.jsx(f,{placeholder:"输入应用的AppKey"})}),t.jsx(l.Item,{name:"notificationMethods",label:"通知方式",children:t.jsx(m,{mode:"multiple",placeholder:"选择通知方式",children:J.map(e=>t.jsx(j,{value:e.value,children:e.label},e.value))})}),t.jsx(l.Item,{name:"status",valuePropName:"checked",children:t.jsx(w,{checkedChildren:"启用",unCheckedChildren:"禁用"})})]})})]})};export{fe as default};
