import{r as a,j as t,S as p,a as H,B as i,M as v}from"./index-C6T66UYw.js";import{l as Y,n as z,o as F,p as M,q as o,r as c,s as d}from"./const-BskLJner.js";import{C as V}from"./index-MJq_1bjb.js";import{S as h}from"./index-gul_2otK.js";import{D as B}from"./index-B-3zsT62.js";import{R as K}from"./ExportOutlined-J_0Br3tR.js";import{F as U}from"./Table-rx-uFvO4.js";import{D as s}from"./index-Dekj6dpf.js";import{T as n}from"./index-BWL1JphO.js";import{R as $}from"./EyeOutlined-DnSgRtn5.js";import"./ClockCircleOutlined-CELcQ7Uv.js";import"./Pagination-B3rYXXPg.js";const{Search:q}=H,{Option:u}=h,{RangePicker:J}=B,ie=()=>{const[j,T]=a.useState([]),[w]=a.useState(!1),[m,S]=a.useState(""),[g,b]=a.useState(""),[y,k]=a.useState(""),[I,A]=a.useState(""),[l,R]=a.useState(null),[_,x]=a.useState(!1);a.useEffect(()=>{T(Y)},[]);const C=[{title:"告警时间",dataIndex:"triggerTime",key:"triggerTime",width:180,sorter:(e,r)=>new Date(e.triggerTime).getTime()-new Date(r.triggerTime).getTime()},{title:"规则名称",dataIndex:"ruleName",key:"ruleName"},{title:"类型",dataIndex:"type",key:"type",render:e=>t.jsx(n,{color:o[e].color,children:o[e].text})},{title:"应用",key:"app",render:e=>t.jsxs("div",{children:[t.jsx("div",{children:e.appName}),t.jsx("code",{style:{fontSize:"12px",color:"#666"},children:e.appKey})]})},{title:"告警级别",dataIndex:"level",key:"level",render:e=>t.jsx(n,{color:c[e].color,children:c[e].text})},{title:"告警内容",dataIndex:"content",key:"content",ellipsis:!0},{title:"处理状态",dataIndex:"status",key:"status",render:e=>t.jsx(n,{color:d[e].color,children:d[e].text})},{title:"处理人",dataIndex:"handler",key:"handler",render:e=>e||"-"},{title:"操作",key:"action",width:120,render:e=>t.jsxs(p,{size:"small",children:[t.jsx(i,{size:"small",icon:t.jsx($,{}),onClick:()=>E(e),children:"详情"}),e.status==="pending"&&t.jsx(i,{size:"small",type:"primary",onClick:()=>L(e.id),children:"处理"})]})}],E=e=>{R(e),x(!0)},L=e=>{v.confirm({title:"处理告警",content:"确定要处理这个告警吗？",onOk:()=>{T(j.map(r=>r.id===e?{...r,status:"processing",handler:"当前用户",handleTime:new Date().toLocaleString()}:r))}})},O=()=>{console.log("导出告警历史")},f=j.filter(e=>{const r=e.ruleName.includes(m)||e.appName.includes(m)||e.content.includes(m),N=!g||e.type===g,P=!y||e.level===y,D=!I||e.status===I;return r&&N&&P&&D});return t.jsxs(V,{children:[t.jsxs("div",{style:{marginBottom:16},children:[t.jsxs(p,{style:{marginBottom:16},children:[t.jsx(q,{placeholder:"搜索规则名称、应用、内容",allowClear:!0,style:{width:300},onSearch:S,onChange:e=>S(e.target.value)}),t.jsx(h,{placeholder:"告警类型",allowClear:!0,style:{width:120},onChange:b,children:z.map(e=>t.jsx(u,{value:e.value,children:e.label},e.value))}),t.jsx(h,{placeholder:"告警级别",allowClear:!0,style:{width:120},onChange:k,children:F.map(e=>t.jsx(u,{value:e.value,children:e.label},e.value))}),t.jsx(h,{placeholder:"处理状态",allowClear:!0,style:{width:120},onChange:A,children:M.map(e=>t.jsx(u,{value:e.value,children:e.label},e.value))}),t.jsx(J,{placeholder:["开始时间","结束时间"]})]}),t.jsx("div",{children:t.jsx(p,{children:t.jsx(i,{icon:t.jsx(K,{}),onClick:O,children:"导出历史"})})})]}),t.jsx(U,{columns:C,dataSource:f,rowKey:"id",loading:w,pagination:{total:f.length,pageSize:10,showSizeChanger:!0,showQuickJumper:!0,showTotal:e=>`共 ${e} 条记录`}}),t.jsx(v,{title:"告警详情",open:_,onCancel:()=>x(!1),footer:[t.jsx(i,{onClick:()=>x(!1),children:"关闭"},"close")],width:800,children:l&&t.jsxs(s,{column:2,bordered:!0,children:[t.jsx(s.Item,{label:"告警时间",span:2,children:l.triggerTime}),t.jsx(s.Item,{label:"规则名称",children:l.ruleName}),t.jsx(s.Item,{label:"告警类型",children:t.jsx(n,{color:o[l.type].color,children:o[l.type].text})}),t.jsx(s.Item,{label:"应用名称",children:l.appName}),t.jsx(s.Item,{label:"AppKey",children:t.jsx("code",{children:l.appKey})}),t.jsx(s.Item,{label:"告警级别",children:t.jsx(n,{color:c[l.level].color,children:c[l.level].text})}),t.jsx(s.Item,{label:"处理状态",children:t.jsx(n,{color:d[l.status].color,children:d[l.status].text})}),t.jsx(s.Item,{label:"告警内容",span:2,children:l.content}),l.handler&&t.jsxs(t.Fragment,{children:[t.jsx(s.Item,{label:"处理人",children:l.handler}),t.jsx(s.Item,{label:"处理时间",children:l.handleTime})]}),l.handleNote&&t.jsx(s.Item,{label:"处理说明",span:2,children:l.handleNote})]})})]})};export{ie as default};
