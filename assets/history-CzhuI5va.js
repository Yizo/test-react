import{r as c,I as R,j as e,S as y,a as N,B as m,M as f}from"./index-C6T66UYw.js";import{b as O}from"./mock-DlhP0AJd.js";import{b as K,S as $}from"./const-BtqL-t4z.js";import{C as z}from"./index-MJq_1bjb.js";import{S as h}from"./index-gul_2otK.js";import{R as B}from"./SearchOutlined-BxpDuFxC.js";import{R as E}from"./ReloadOutlined-DY0v2jjP.js";import{F as H}from"./Table-rx-uFvO4.js";import{D as r}from"./index-Dekj6dpf.js";import{T as i}from"./index-BWL1JphO.js";import{R as P}from"./EyeOutlined-DnSgRtn5.js";import"./Pagination-B3rYXXPg.js";var _={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M793 242H366v-74c0-6.7-7.7-10.4-12.9-6.3l-142 112a8 8 0 000 12.6l142 112c5.2 4.1 12.9.4 12.9-6.3v-74h415v470H175c-4.4 0-8 3.6-8 8v60c0 4.4 3.6 8 8 8h618c35.3 0 64-28.7 64-64V306c0-35.3-28.7-64-64-64z"}}]},name:"rollback",theme:"outlined"};function x(){return x=Object.assign?Object.assign.bind():function(n){for(var l=1;l<arguments.length;l++){var o=arguments[l];for(var t in o)Object.prototype.hasOwnProperty.call(o,t)&&(n[t]=o[t])}return n},x.apply(this,arguments)}const A=(n,l)=>c.createElement(R,x({},n,{ref:l,icon:_})),D=c.forwardRef(A),{Option:d}=h,{Search:F}=N,ee=()=>{const[n,l]=c.useState(!1),[o]=c.useState(O),[t,b]=c.useState(null),[w,g]=c.useState(!1),[I,v]=c.useState({appKey:"",changeType:"",status:""}),T=[{title:"应用名称",dataIndex:"appName",key:"appName",width:120},{title:"AppKey",dataIndex:"appKey",key:"appKey",width:150,render:a=>e.jsx("code",{children:a})},{title:"配置版本",dataIndex:"version",key:"version",width:100,render:a=>e.jsx(i,{color:"blue",children:a})},{title:"变更类型",dataIndex:"changeType",key:"changeType",width:100,render:a=>{const s={create:"green",update:"blue",rollback:"orange",publish:"purple"},u={create:"创建",update:"更新",rollback:"回滚",publish:"发布"};return e.jsx(i,{color:s[a],children:u[a]})}},{title:"操作人",dataIndex:"operatorName",key:"operatorName",width:100},{title:"变更时间",dataIndex:"changeTime",key:"changeTime",width:160},{title:"状态",dataIndex:"status",key:"status",width:80,render:a=>e.jsx(i,{color:a==="success"?"success":"error",children:a==="success"?"成功":"失败"})},{title:"变更内容",dataIndex:"changeContent",key:"changeContent",ellipsis:!0},{title:"操作",key:"action",width:150,render:(a,s)=>e.jsxs(y,{children:[e.jsx(m,{type:"link",size:"small",icon:e.jsx(P,{}),onClick:()=>k(s),children:"详情"}),s.changeType!=="rollback"&&e.jsx(m,{type:"link",size:"small",icon:e.jsx(D,{}),onClick:()=>S(s),children:"回滚"})]})}],k=a=>{b(a),g(!0)},S=a=>{f.confirm({title:"确认回滚",content:`确定要回滚到版本 ${a.version} 吗？此操作将创建一个新的配置版本。`,okText:"确认回滚",cancelText:"取消",onOk:async()=>{l(!0);try{console.log("回滚配置:",a),await j()}catch(s){console.error("回滚失败:",s)}finally{l(!1)}}})},j=async()=>{l(!0);try{console.log("刷新配置历史数据")}catch(a){console.error("刷新失败:",a)}finally{l(!1)}},C=a=>{console.log("搜索:",a)},p=(a,s)=>{v(u=>({...u,[a]:s})),console.log("筛选条件变更:",{...I,[a]:s})};return e.jsxs("div",{className:"config-history-page",children:[e.jsxs(z,{children:[e.jsxs("div",{className:"page-header",children:[e.jsx("h2",{children:"配置历史"}),e.jsx("div",{className:"filters-bar",style:{marginBottom:16},children:e.jsxs(y,{wrap:!0,children:[e.jsxs(h,{placeholder:"选择应用",style:{width:200},allowClear:!0,onChange:a=>p("appKey",a||""),children:[e.jsx(d,{value:"ecommerce-main",children:"电商主站"}),e.jsx(d,{value:"user-center",children:"用户中心"}),e.jsx(d,{value:"payment-system",children:"支付系统"})]}),e.jsx(h,{placeholder:"变更类型",style:{width:120},allowClear:!0,onChange:a=>p("changeType",a||""),children:K.map(a=>e.jsx(d,{value:a.value,children:a.label},a.value))}),e.jsx(h,{placeholder:"状态",style:{width:100},allowClear:!0,onChange:a=>p("status",a||""),children:$.map(a=>e.jsx(d,{value:a.value,children:a.label},a.value))}),e.jsx(F,{placeholder:"搜索操作人、变更内容...",style:{width:250},onSearch:C,enterButton:e.jsx(B,{})}),e.jsx(m,{icon:e.jsx(E,{}),onClick:j,loading:n,children:"刷新"})]})})]}),e.jsx(H,{columns:T,dataSource:o,rowKey:"id",loading:n,pagination:{total:o.length,pageSize:10,showSizeChanger:!0,showQuickJumper:!0,showTotal:a=>`共 ${a} 条记录`},scroll:{x:1200}})]}),e.jsx(f,{title:"配置变更详情",open:w,onCancel:()=>g(!1),footer:null,width:800,children:t&&e.jsxs(r,{column:2,bordered:!0,children:[e.jsx(r.Item,{label:"应用名称",children:t.appName}),e.jsx(r.Item,{label:"AppKey",children:e.jsx("code",{children:t.appKey})}),e.jsx(r.Item,{label:"配置版本",children:e.jsx(i,{color:"blue",children:t.version})}),e.jsx(r.Item,{label:"变更类型",children:e.jsx(i,{color:t.changeType==="create"?"green":t.changeType==="update"?"blue":t.changeType==="rollback"?"orange":"purple",children:t.changeType==="create"?"创建":t.changeType==="update"?"更新":t.changeType==="rollback"?"回滚":"发布"})}),e.jsxs(r.Item,{label:"操作人",children:[t.operatorName," (",t.operator,")"]}),e.jsx(r.Item,{label:"变更时间",children:t.changeTime}),e.jsx(r.Item,{label:"状态",children:e.jsx(i,{color:t.status==="success"?"success":"error",children:t.status==="success"?"成功":"失败"})}),e.jsx(r.Item,{label:"变更内容",span:2,children:t.changeContent}),t.description&&e.jsx(r.Item,{label:"备注说明",span:2,children:t.description})]})})]})};export{ee as default};
