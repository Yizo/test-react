import{r,I as O,F as o,j as e,B as x,M as g,a as I,S as A,s as l}from"./index-C6T66UYw.js";import{i as M,C as p,j as _,k as T,T as v}from"./const-BskLJner.js";import{D as F}from"./common-Oid95yXv.js";import{C as z}from"./index-MJq_1bjb.js";import{R as D}from"./PlusOutlined-DadAM9jt.js";import{F as P}from"./Table-rx-uFvO4.js";import{S as b}from"./index-gul_2otK.js";import{T as C}from"./index-BWL1JphO.js";import{S as H}from"./index-D3Omcvxu.js";import{R as V}from"./EditOutlined-9U3olPbu.js";import{R as $}from"./DeleteOutlined-CETmvlP7.js";import"./Pagination-B3rYXXPg.js";import"./EditOutlined-DdmGLkPL.js";import"./DeleteOutlined-DFutYCzo.js";var U={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M512 472a40 40 0 1080 0 40 40 0 10-80 0zm367 352.9L696.3 352V178H768v-68H256v68h71.7v174L145 824.9c-2.8 7.4-4.3 15.2-4.3 23.1 0 35.3 28.7 64 64 64h614.6c7.9 0 15.7-1.5 23.1-4.3 33-12.7 49.4-49.8 36.6-82.8zM395.7 364.7V180h232.6v184.7L719.2 600c-20.7-5.3-42.1-8-63.9-8-61.2 0-119.2 21.5-165.3 60a188.78 188.78 0 01-121.3 43.9c-32.7 0-64.1-8.3-91.8-23.7l118.8-307.5zM210.5 844l41.7-107.8c35.7 18.1 75.4 27.8 116.6 27.8 61.2 0 119.2-21.5 165.3-60 33.9-28.2 76.3-43.9 121.3-43.9 35 0 68.4 9.5 97.6 27.1L813.5 844h-603z"}}]},name:"experiment",theme:"outlined"};function f(){return f=Object.assign?Object.assign.bind():function(n){for(var a=1;a<arguments.length;a++){var c=arguments[a];for(var d in c)Object.prototype.hasOwnProperty.call(c,d)&&(n[d]=c[d])}return n},f.apply(this,arguments)}const B=(n,a)=>r.createElement(O,f({},n,{ref:a,icon:U})),Y=r.forwardRef(B),{Option:G}=b,{TextArea:S}=I,re=()=>{const[n,a]=r.useState([]),[c]=r.useState(!1),[d,m]=r.useState(!1),[h,j]=r.useState(null),[u]=o.useForm();r.useEffect(()=>{a(M)},[]);const y=()=>{j(null),u.resetFields(),m(!0)},k=t=>{j(t),u.setFieldsValue(t),m(!0)},E=t=>{g.confirm({title:"确认删除",content:"确定要删除这个告警渠道吗？",onOk:()=>{a(n.filter(s=>s.id!==t)),l.success("删除成功")}})},R=t=>{l.info(`正在测试 ${t.name} ...`),setTimeout(()=>{Math.random()>.3?(l.success("测试通知发送成功"),a(n.map(i=>i.id===t.id?{...i,lastTestTime:new Date().toLocaleString(),testResult:"success"}:i))):(l.error("测试通知发送失败"),a(n.map(i=>i.id===t.id?{...i,lastTestTime:new Date().toLocaleString(),testResult:"failed"}:i)))},2e3)},w=()=>{u.validateFields().then(t=>{if(h)a(n.map(s=>s.id===h.id?{...h,...t}:s)),l.success("更新成功");else{const s={id:Date.now().toString(),createTime:new Date().toLocaleString(),status:"active",...t};a([...n,s]),l.success("创建成功")}m(!1)})},L=t=>{a(n.map(s=>s.id===t?{...s,status:s.status==="active"?"inactive":"active"}:s)),l.success("状态更新成功")},N=[{title:"渠道名称",dataIndex:"name",key:"name"},{title:"类型",dataIndex:"type",key:"type",render:t=>e.jsx(C,{color:T[t].color,children:T[t].label})},{title:"目标",dataIndex:"target",key:"target",ellipsis:!0},{title:"状态",dataIndex:"status",key:"status",render:(t,s)=>e.jsx(H,{checked:t==="active",onChange:()=>L(s.id),checkedChildren:"启用",unCheckedChildren:"禁用"})},{title:"最后测试",key:"lastTest",render:(t,s)=>e.jsx("div",{children:s.lastTestTime?e.jsxs("div",{children:[e.jsx("div",{children:s.lastTestTime}),e.jsx(C,{color:v[s.testResult].color,children:v[s.testResult].text})]}):e.jsx("span",{className:"text-gray-400",children:"未测试"})})},{title:"创建时间",dataIndex:"createTime",key:"createTime"},{title:"操作",key:"action",render:(t,s)=>e.jsxs(A,{size:"small",children:[e.jsx(x,{size:"small",icon:e.jsx(Y,{}),onClick:()=>R(s),disabled:s.status==="inactive",children:"测试"}),e.jsx(x,{size:"small",icon:e.jsx(V,{}),onClick:()=>k(s),children:"编辑"}),e.jsx(x,{size:"small",danger:!0,icon:e.jsx($,{}),onClick:()=>E(s.id),children:"删除"})]})}];return e.jsxs("div",{className:"space-y-4",children:[e.jsxs(z,{children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h2",{className:"text-lg font-medium",children:"告警渠道管理"}),e.jsx(x,{type:"primary",icon:e.jsx(D,{}),onClick:y,children:"新建渠道"})]}),e.jsx(P,{columns:N,dataSource:n,rowKey:"id",loading:c,pagination:F})]}),e.jsx(g,{title:h?"编辑告警渠道":"新建告警渠道",open:d,onOk:w,onCancel:()=>m(!1),width:600,children:e.jsxs(o,{form:u,layout:"vertical",children:[e.jsx(o.Item,{name:"name",label:"渠道名称",rules:p.name,children:e.jsx(I,{placeholder:"输入渠道名称"})}),e.jsx(o.Item,{name:"type",label:"渠道类型",rules:p.type,children:e.jsx(b,{placeholder:"选择渠道类型",children:_.map(t=>e.jsx(G,{value:t.value,children:t.label},t.value))})}),e.jsx(o.Item,{name:"target",label:"目标地址",rules:p.target,children:e.jsx(S,{rows:3,placeholder:"邮件地址、手机号、Webhook URL等"})}),e.jsx(o.Item,{name:"description",label:"描述",children:e.jsx(S,{rows:2,placeholder:"输入渠道描述"})})]})})]})};export{re as default};
